(()=>{"use strict";class t{static _callProc(e,n,o,r){return e().then((t=>t)).catch((c=>{if(console.error(c),c&&"no retry"===c.message)throw new Error("no retry");if(n<r){const c=n+1;return console.error("request failed, retry("+c+")"),o<=0?t._callProc(e,c,o,r):new Promise((t=>{setTimeout((()=>{t(null)}),o)})).then((()=>t._callProc(e,c,o,r)))}throw c}))}static call(e,n=1500,o=5){return t._callProc(e,0,n,o)}static parseQuery(t){const e={},n=t.split("?"),o=(1===n.length?n[0]:n[1]).split("&");for(let t=0;t<o.length;t++){const n=o[t].split("=");e[decodeURIComponent(n[0])]=decodeURIComponent(n[1]||"")}return e}static wait(t){return new Promise((e=>{setTimeout((()=>{e()}),t)}))}}const e=t;var n,o;let r=document.getElementById("its-product-analysis");r&&r.remove(),r=document.createElement("iframe"),r.id="its-product-analysis",r.src=chrome.runtime.getURL("product_analysis/product_analysis.html"),r.setAttribute("scrolling","no");const c=null===(n=document.body.querySelector("#content"))||void 0===n?void 0:n.childNodes[0].childNodes[0];r.setAttribute("style","\n    width: 0; height: 0;\n    border: none;\n  "),console.log("product-analysis script has been loaded"),c&&(null===(o=document.body.querySelector("#content"))||void 0===o||o.childNodes[0].insertBefore(r,c)),window.itsProductPageCrawlingMap||(window.itsProductPageCrawlingMap={}),window.addEventListener("message",(function(t){var n,o,c,i,s,l,a;return i=this,s=void 0,a=function*(){if("productPageCrawling"===t.data.m){const t=window.location.pathname.split("/"),e=t[t.length-1];if(!e)return;let c=window.itsProductPageCrawlingMap[e];if(!c){window.itsProductPageCrawlingMap[e]={};let t=null;try{const e=document.body.innerHTML,o=(new DOMParser).parseFromString(e,"text/html").body.childNodes[2].textContent,r=null==o?void 0:o.split("window.__PRELOADED_STATE__=")[1];if(c=JSON.parse(null!=r?r:""),!c.product.A.id)throw t=(null===(n=c.smartStoreV2)||void 0===n?void 0:n.channelNo)||c.brandStore.A.channelNo,new Error("PRODUCT NOT FOUND")}catch(n){try{if(t&&e){const n=yield fetch(`${"brand.naver.com"===location.host?"https://brand.naver.com/n":"https://smartstore.naver.com/i"}/v1/stores/${t}/products/${e}`).then((t=>t.json()));console.log("success"),c.product.A=n}else c=null}catch(t){c=null}}}null===(o=r.contentWindow)||void 0===o||o.postMessage({data:c,m:"productPageCrawling"},"*"),window.itsProductPageCrawlingMap[e]=c}else if("pageExtract"===t.data.m){const t=document.body.scrollHeight;window.scrollTo(0,t),yield e.wait(500);const n=document.body.innerHTML;null===(c=r.contentWindow)||void 0===c||c.postMessage({html:n,m:"pageExtract"},"*"),window.scroll(t,0)}},new((l=void 0)||(l=Promise))((function(t,e){function n(t){try{r(a.next(t))}catch(t){e(t)}}function o(t){try{r(a.throw(t))}catch(t){e(t)}}function r(e){var r;e.done?t(e.value):(r=e.value,r instanceof l?r:new l((function(t){t(r)}))).then(n,o)}r((a=a.apply(i,s||[])).next())}))}))})();